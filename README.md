# Exploring-the-Relationship-Between-Stock-Bar-Sentiment-and-Stocks-Price-Based-on-Statistical-Analysis
Exploring the relationship between stock bar sentiment and stocks based on statistical analysis 基于统计分析探索股吧情绪值与股票间的关系  
R语言-期末大作业  
大三下  

# 基于统计分析探索股吧情绪值与股票间的关系

## 一、文件目录

```
R_QIMO\
├── raw_data\  # 原始数据文件夹
|   ├── website_content.txt  # 爬取到的网页文本
|   └── structured_data.csv  # 将网页文本转换成的结构化数据
├── crawl_comments.R  # 爬取东方财富官网青岛啤酒股吧评论
├── data_preprocess.R  # 数据预处理，把爬取到的非结构化数据转换成结构化数据
├── quantify_emotions.R  # 量化情绪
├── summary_analysis.R  # 统计摘要
├── PCA.R  # 主成分分析
├── plot.R  # 画出情感值与收盘价、成交量间的叠加折线图
├── relativity_analysis.R  # 相关性分析
├── regression_analysis.R  # 回归分析
├── comment.csv  # 爬取到的5月1日到5月31日青岛啤酒股吧的评论
├── positive.txt  # 正面情感词典
├── negative.txt  # 负面情感词典
├── daliy_sentiment.csv  # 每日情感值
└── stock_600600.csv  # 青岛啤酒股票数据
```

## 二、实验目的

​	通过严谨的统计建模方法，深入探究投资者情绪与股票的内在关联机制。实验聚焦于验证股吧评论所反映的集体情绪是否对当日股价波动具有预测效力，并量化情绪指标与市场交易行为的因果关系。具体目标包括：

1. 构建投资者情绪量化体系
   通过自然语言处理技术，结合专业金融情感词典（正/负面词库），将非结构化的股吧评论文本转化为可量化的每日情绪值指标，建立反映市场情绪波动的标准化度量。
2. 揭示情绪与市场指标的动态关联
   利用时间序列可视化与统计相关性分析，识别情绪值与收盘价、成交量的同步及滞后关系，重点验证"当日情绪是否显著驱动当日股价"的核心假设，并探索情绪影响的时效性特征。
3. 建立股价回归统计模型
   通过多元回归、多项式回归及交互效应分析，构建情绪与交易量联合解释股价变动的预测模型，确定情绪对股价的线性/非线性作用规律，并借助方差分析筛选最优解释模型。

## 三、实验数据

### 1.股吧评论数据获取

​	使用crawl_comments.R从东方财富网青岛啤酒（600600）股吧页面爬取用户评论数据。 httr包发送HTTP请求， rvest包和xml2包解析HTML内容。通过设置User-Agent模拟浏览器请求，过滤掉无关标签（如script、style等），提取纯文本评论内容。爬取结果保存为website_content.txt。

### 2.股票数据获取

​	从akshare API接口获取青岛啤酒（600600）股票从5月1日到5月31日间19个交易日的股票数据。保存为stock_600600.csv，包含六个字段：date、open、close、high、low、volume。

## 四、实验过程

### 1.数据预处理

​	把每个网页对应的website_content.txt使用data_preprocess.R转换成结构化数据structured_data.csv。把所有structured_data.csv合并成一个完成的comment.csv文件。comment.csv中共包含从5月1日到5月31日评论共计720行，5列数据，5列对应阅读量、评论量、评论文本、用户名、评论时间五个字段。

### 2.量化情绪

​	使用quantify_emotions.R读取预定义的正面词汇表（ positive.txt ）和负面词汇表（ negative.txt ）。按日期分组聚合评论数据，对每条评论统计正负词汇出现次数（正面词汇+1，负面词汇-1）。每日情绪计算公式：
$$
\text{当天情绪值} = \frac{\text{当天总得分}}{\text{每条评论字数} \times \text{当天评论条数}}
$$
​	最终把每天的情绪值保存为daliy_sentiment.csv。

### 3.统计摘要

​	summary_analysis.R运行结果：

![image](https://github.com/user-attachments/assets/d04b7f3c-4b09-4a2e-9358-cdd6a9db6b81)

​	daily_sentiment.csv包含19条记录，date字段为字符型；mood字段的最小值为-0.000287，第一四分位数为-0.0001925，中位数为0.000101，均值为0.0005405，第三四分位数为0.000196，最大值为0.000727。

![image](https://github.com/user-attachments/assets/57d4ca87-4264-46f0-8c0a-fc4c45b9366d)

​	stock_600600.csv同样包含19条记录，date字段为字符型；open字段、close字段、high字段、low字段、volume字段都包含最小值、第一四分位数、中位数、平均数、第三四分位数、最大数。

### 4.主成分分析（PCA）

​	通过PCA技术，分析股票技术指标（成交量、情绪值等）与市场情绪指标之间的内在关联性，挖掘影响股价波动的潜在综合因子。输出结果可帮助识别最具解释力的主成分，为后续建模提供基础。

​	选取四个关键指标（volume、mood、price_change、price_range）构建PCA数据集，并对数据进行标准化处理（均值为0，标准差为1）。

​	PCA分析结果，主成分重要性：

![image](https://github.com/user-attachments/assets/20ac4d7e-6ed2-41c3-a0fb-ea27885034db)

​	PC1（市场活跃度因子）：解释61.13%的方差（标准差1.56），是最重要的维度。

​	PC2（情绪主导因子）：解释25.52%的方差（标准差1.01），累计达86.66%。

​	PC3（价格异动因子）：解释11.77%的方差，累计98.43%。

​	PC4（噪声维度）：仅解释1.57%的方差，信息量极少。

​	前两个主成分已涵盖86.7%的原始信息。

​	主成分载荷矩阵：

![image](https://github.com/user-attachments/assets/3ac6e6ff-a255-45b5-8e4f-a41a7dd425ca)

​	PC1（市场活跃度因子）：所有交易指标均正相关（volume 0.63, price_range 0.58, price_change 0.51），反映市场整体活跃程度，高成交量伴随价格大幅波动，mood情绪影响微弱（0.12）。

​	PC2（情绪主导因子）：由mood情绪主导（0.95极高载荷），交易指标影响微弱（|载荷|<0.3），捕捉独立于交易的情绪维度。

​	PC3（价格异动因子）：price_change正载荷(0.75) vs price_range负载荷(-0.59)，识别价格变化与波动幅度背离的情况（如大涨但波动小）。

​	PC4（噪声维度）：volume负相关(-0.77)与price_range正相关(0.56)，因解释力过低(<2%)，实际可忽略。

​	样本主成分得分：

![image](https://github.com/user-attachments/assets/ce3a1751-6d18-4e24-90d9-17f465bc2751)

```
        PC1       PC2        PC3
[1,]  0.1008230 2.2005546  1.6523888  # 高情绪+高效价格变动
[2,] -0.2581634 1.2743007 -0.6431006  # 高情绪+低效震荡
[3,] -0.5352261 1.1997369 -0.1090810  # 高情绪+中性效率
[4,] -0.6758812 0.1943016  0.2198342  # 低情绪+中等效率
```

​	样本1：情绪高涨(PC2↑)且价格变动高效(PC3↑)

​	样本2-3：情绪主导但价格效率低

​	样本4：市场冷清(PC1↓)且情绪中性

![image](https://github.com/user-attachments/assets/acb30d35-c118-4738-8278-45492c8159d8)

​	碎石图直观显示拐点和PC1-PC2的主导地位，后续分析优先使用这两个成分。

### 5.数据可视化

![image](https://github.com/user-attachments/assets/3b176887-5e65-4419-b007-26c6bdfcf08e)

​	情绪值与收盘价走势图通过scale_mood函数对情绪值进行Z-score标准化，公式：
$$
z = \frac{x-\mu}{\sigma}
$$
​	并将标准化后的情绪值线性变换至收盘价的量纲范围，实现情绪值与收盘价在同一纵坐标下的趋势对比。

​	根据可视化图像显示，情绪值与收盘价趋势大致相同，并且情绪值相较于收盘价有一定的滞后效应。

![image](https://github.com/user-attachments/assets/4ba73bc8-043d-488f-960b-e1a035c785b8)

​	情绪值与收盘价走势图显示情绪值与成交量趋势大致相同，并且情绪值相较于收盘价有一定的滞后效应。

### 6.相关性分析

#### 6.1当天情绪值与当天收盘价关系

​	使用stats包中的cor.test()函数，该函数默认计算皮尔逊相关系数（适用于双变量正态分布数据），公式为：
$$
r = \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum (x_i - \bar{x})^2 \sum (y_i - \bar{y})^2}}
$$
​	其中：x为情绪值（mood），y为收盘价（close）或成交量（volume）。

​	relativity_analysis.R运行结果：

​	使用皮尔逊相关系数对当天情绪值与当天收盘价相关性分析结果：

![image](https://github.com/user-attachments/assets/a8e0eae6-4cdb-4bdd-b51c-7251eec0ac2f)

​	分析结论：当天情绪值与当天收盘价的相关系数为0.7092558，属于正相关。p值=0.0006727（远小于0.05的显著性水平），表明拒绝原假设（原假设为“两变量不相关”），情绪值与收盘价的线性相关性统计显著 。95%置信区间为[0.3762584, 0.8799793]，区间不包含0，进一步验证了两者存在显著正相关关系。结果表明投资者情绪值越高，股票收盘价越高，且两者的正相关性显著且较强。

![image](https://github.com/user-attachments/assets/57a316ac-18a6-4bdb-8fce-7a8d27934dec)

​	情绪值与收盘价散点图表明散点整体呈现向上集中趋势 ，情绪值（x轴）越高，收盘价（y轴）对应的点越倾向于分布在更高位置，直观反映两者的正相关关系。红色回归线斜率为正，进一步验证了情绪值上升时收盘价的增长趋势。

#### 6.2 前一天情绪值与当天收盘价关系

​	继续使用皮尔逊相关系数探索前一天情绪值与当天收盘价的关系：

![image](https://github.com/user-attachments/assets/528d32f9-52fc-4311-ba38-3d3c11ca8d2c)

​	分析结论：前一天情绪值与当天收盘价的相关系数为0.4612173。p值=0.05404（大于0.05的显著性水平），表明接受原假设（原假设为“两变量不相关”），前一天情绪值与当天收盘价的无显著线性相关性 。结果表明前一天的情绪不会影响当天收盘价。

![image](https://github.com/user-attachments/assets/a21881b7-2104-46c5-80f7-fede7b3140ee)

​	从图中看出点相对较为分散。

#### 6.3 前两天情绪值平均值与当天收盘价关系

​	继续使用皮尔逊相关系数探索前两天平均情绪值与当天收盘价的关系：

![image](https://github.com/user-attachments/assets/a151b656-4439-4110-bd8f-e08744ad717b)

​	分析结论：前两天情绪平均值与当天收盘价的相关系数为0.3084996。p值=0.2283（大于0.05的显著性水平），表明接受原假设（原假设为“两变量不相关”），前两天情绪平均值与当天收盘价的无显著线性相关性 。结果表明前两天的情绪不会影响当天收盘价。

![image](https://github.com/user-attachments/assets/84c32ae3-4c5f-40dc-9449-0396d63fadb8)

​	从图中看出点相对较为分散。

#### 6.4当天情绪值与成交量间的关系

​	使用皮尔逊相关系数对情绪值与成交量相关系分析结果：

![image](https://github.com/user-attachments/assets/db1dd10f-ab94-406d-b1b2-8012acd855ff)

​	分析结论：情绪值与成交量的相关系数为0.160508，说明没有显著相关关系 。p值=0.5116（大于0.05的显著性水平），表明无法拒绝原假设，情绪值与成交量的线性相关性统计不显著 。95%置信区间为[-0.3167972, 0.5729470]，区间包含0，说明两者可能不存在显著的线性相关关系。结果表明投资者情绪值与股票成交量的无显著线性相关性且不显著，情绪波动对成交量的直接影响未被统计证据支持。

![image](https://github.com/user-attachments/assets/ccc8f434-467a-456f-a491-14c504023799)

​	情绪值与成交量散点图表明散点分布较为分散，情绪值（x轴）与成交量（y轴）的点无明显集中趋势，部分高情绪值对应低成交量，低情绪值对应高成交量的情况存在，无法直观判断线性关系。红色回归线斜率接近0，说明情绪值对成交量的预测能力较弱。

#### 6.5相关性总结

​	相关性分析结论：股票收盘价与投资者当天情绪存在显著的正相关关系，但与前一天情绪、前两天情绪、成交量的相关性不显著。这表明在青岛啤酒（600600）中，当天的情绪与股价有影响，前一天情绪、前两天情绪、成交量对股价的影响不大。投资者情绪更可能通过影响当天股价来反映市场预期。

### 7.回归分析

#### 7.1一元线性回归

![image](https://github.com/user-attachments/assets/937d7571-ff80-4dfd-9976-b361ca36054a)

​	回归方程：close=73.5377+3031.6871×mood

![image](https://github.com/user-attachments/assets/bbee11bd-e134-4c18-b860-5c9181442c88)

​	分析结论：市场情绪（mood）对收盘价有显著正向影响（p=0.0007），情绪每增加1单位，收盘价上升约3031.69单位。模型解释力中等（调整 R²=0.4738），但残差标准误较高（0.8179），表明存在未捕获的变异。

#### 7.2多元线性回归

![image](https://github.com/user-attachments/assets/9ec73865-5d35-4888-aaaf-0e4357b7686c)

​	回归方程：close=72.56+2754×mood+0.00001572×volume

![image](https://github.com/user-attachments/assets/18ec9c82-d1ad-4525-b7d4-fdbbf0206182)

​	分析结论：情绪（p=0.0005) 和交易量（p=0.014) 均显著正向影响收盘价。加入交易量后，模型解释力提升（调整 R²=0.6204)，残差标准误降至0.6948。交易量每增加1单位，收盘价微增1.572×10−51.572×10−5 单位。

#### 7.3有交互项的回归

![image](https://github.com/user-attachments/assets/11a88f0f-f48c-49d8-a0ce-83b932e4c692)

​	回归方程：close=72.39+4518×mood+0.00001907×volume−0.03092×mood×volume

![image](https://github.com/user-attachments/assets/38c44346-1a44-4f0c-b4d4-380b4c0bce1a)

​	分析结论：交互项（mood:volume）不显著（p=0.578)，表明情绪与交易量无显著协同效应。交易量单独显著（p=0.036)，但模型解释力未改善（调整 R²=0.6036），且情绪系数变为不显著（p=0.174)。

#### 7.4多项式回归

![image](https://github.com/user-attachments/assets/8dbce268-6449-459f-9805-c07b3016f55f)

​	回归方程：close=73.77+4275×mood−4341000×mood²

![image](https://github.com/user-attachments/assets/8fba9554-f587-4792-9b4c-db75e70e60e5)

​	分析结论：情绪二次项显著（p=0.041)，揭示倒U型关系：情绪升高初期推升股价，但过度乐观后可能回落。模型解释力（调整 R²=0.5724) 低于线性模型，暗示需结合其他变量。

#### 7.5多元多项式回归

![image](https://github.com/user-attachments/assets/2f1e8951-48ad-4f10-a5a0-907983285e3d)

​	回归方程：close=72.89+3757×mood−3357000×mood²+0.00001334×volume

​	分析结果：成交量显著（p=0.027)，情绪二次项边缘显著（p=0.075)。模型解释力提升（调整 R²=0.6746)，残差标准误降至0.6433，为当前最优模型。

#### 7.6更复杂的多元多项式回归

![image](https://github.com/user-attachments/assets/32c93762-d4aa-4902-8edc-10be4747aabc)

​	回归方程：close=74.13+3839×mood−3238000×mood²−0.00001899×volume+0.0000000001636×volume²−0.00001899×volume+0.0000000001636×volume²

​	分析结果：交易量二次项不显著（p=0.478)，调整 R² 微升至0.6871，但过度复杂化。

#### 7.7更复杂的含有交互项的多元多项式回归

![image](https://github.com/user-attachments/assets/f5c1162a-37fd-4307-9d16-4cfa84dd7dde)

​	回归方程：close=74.40+7063×mood−2615000×mood²−0.00002871×volume+0.0000000002470×volume²−0.00002871×volume+0.0000000002470×volume²−0.05872×(mood×volume)−0.05872×(mood×volume)
​	分析结果：交互项仍不显著（p=0.347)，调整 R² 降至0.686。高阶项未显著改善模型，模型5更简洁有效。

#### 7.8方差分析

![image](https://github.com/user-attachments/assets/185422ca-6d24-4fff-88d3-6cba4e01c356)

![image](https://github.com/user-attachments/assets/34fd625d-a378-4385-804b-734314994797)

​	情绪分组（正/负）对收盘价影响极显著（p=0.0002）。正情绪组收盘价均值显著更高（箱线图显示正情绪组中位数约74.5，负情绪组约73.2），验证情绪对股价的整体作用。

​	通过方差分析对模型进行对比：

![image](https://github.com/user-attachments/assets/3223dfdd-0c78-411f-afc0-259a0bb114f2)

​	线性模型对比：模型2（加入交易量）显著优于模型1（p=0.017），但模型3（交互项）无改进（p=0.578)。

![image](https://github.com/user-attachments/assets/659f2f78-f68f-408f-a2fc-e8c127add1c8)

​	多项式模型对比：模型5（加入交易量）显著优于模型4（p=0.027），而模型6和7无进一步改进（p>0.2)。

#### 7.9回归分析结论

​	最终推荐模型：模型5（二次情绪+交易量）。

​	回归方程：close=72.89+3757×mood−3357000×mood²+0.00001334×volume

​	该模型调整 R²最高（0.6746）、变量显著、结构简洁，且通过模型比较验证其优越性。情绪呈倒U型影响，交易量为正向线性贡献。

## 五、实验结论

​	**投资者情绪与股价存在显著的即时联动效应**。通过皮尔逊相关分析发现，当日股吧情绪值与收盘价呈现高度正相关（r = 0.709, p < 0.001），表明投资者情绪升温会显著推高当日股价。这一关系通过散点图和回归模型得到进一步验证：一元线性回归显示情绪每提升1单位，股价上涨约3031.69单位（p = 0.0007），且情绪分组（正/负）的方差分析证实正情绪组股价均值显著更高（p = 0.0002）。值得注意的是，情绪对股价的影响具有时效性——滞后1日或2日的情绪值与当日股价无显著相关性，说明情绪效应主要作用于当前交易日。

​	**情绪与股价呈非线性倒U型关系**。在多项式回归模型中，情绪二次项显著为负（p = 0.041），揭示情绪对股价的影响存在阈值效应：情绪上升初期推动股价上涨，但当情绪过度乐观时可能引发回调。最优模型（调整R²=0.6746）同时纳入了成交量变量，其方程为：

close=72.89+3757×mood−3357000×mood²+0.00001334×volume

​	该模型表明成交量虽与情绪值无直接相关性（r = 0.161, p = 0.512），但在多元框架下对股价有独立的正向贡献（p = 0.027）。

​	**市场维度可通过两个主成分解构**。主成分分析（PCA）提取出两个核心因子：PC1（市场活跃度因子）解释61.13%方差，反映高成交量与价格波动的协同变化；PC2（情绪主导因子）解释25.52%方差，载荷系数达0.95，证明情绪构成独立于交易数据的市场维度。二者累计解释86.66%方差，凸显情绪在刻画市场状态中的关键地位。

​	**价值**：青岛啤酒股吧情绪是股价变动的即时风向标，其影响兼具即时性和非线性特征，验证了互联网非结构化文本的金融价值，为量化投资提供日内交易信号与策略优化依据，更深化了对A股散户情绪驱动机制的理解。而结合情绪二次项与成交量的回归模型能有效解释股价波动。这一发现为量化投资者情绪对特定个股的定价作用提供了实证依据。

​        
